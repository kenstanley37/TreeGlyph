<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:controls="clr-namespace:TreeGlyph.UI.Controls;assembly=TreeGlyph.UI"
             xmlns:views="clr-namespace:TreeGlyph.UI.Views.MainPageViews"
             xmlns:vm="clr-namespace:TreeGlyph.UI.ViewModels.MainPageViewModel"
             x:Class="TreeGlyph.UI.Views.MainPageViews.MainPage"
             x:DataType="vm:MainViewModel"
             BackgroundColor="{StaticResource BaseBackground}">

    <Grid RowDefinitions="Auto,*"
          Padding="20"
          RowSpacing="12">

        <!-- 🔧 Toolbar + Status -->
        <VerticalStackLayout Grid.Row="0"
                             Spacing="12"
                             Padding="0,0,0,12">

            <views:ToolbarView ViewModel="{Binding Toolbar}" />

            <!-- 🟦 Status Panel -->
            <Grid IsVisible="{Binding IsBusy}"
                  Style="{StaticResource PanelContainer}"
                  RowDefinitions="Auto,*"
                  Margin="0,4,0,0">

                <VerticalStackLayout Grid.Row="1"
                                     Spacing="8">

                    <Label Text="Building tree..."
                           Style="{StaticResource CaptionText}"
                           FontAttributes="Italic"
                           HorizontalOptions="Center" />

                    <Grid ColumnDefinitions="*,Auto"
                          ColumnSpacing="12">

                        <ProgressBar Grid.Column="0"
                                     Progress="{Binding Progress}"
                                     Style="{StaticResource StandardProgressBar}" />

                        <Button Grid.Column="1"
                                Text="Cancel"
                                Command="{Binding CancelTreeBuildCommand}"
                                Style="{StaticResource AccentButton}"
                                Padding="10,4"
                                VerticalOptions="Center" />
                    </Grid>
                </VerticalStackLayout>
            </Grid>
        </VerticalStackLayout>

        <!-- 🧩 Main Layout -->
        <Grid Grid.Row="1"
              ColumnDefinitions="Auto,*,Auto"
              ColumnSpacing="12"
              HorizontalOptions="Fill"
              VerticalOptions="Fill">

            <!-- 📁 Panel 1: Folder View -->
            <Grid Grid.Column="0"
                  Style="{StaticResource PanelContainer}"
                  RowDefinitions="Auto,*"
                  WidthRequest="360"
                  HorizontalOptions="Start"
                  VerticalOptions="Fill">

                <views:FolderPanelView Grid.Row="1"
                                       ViewModel="{Binding FolderPanel}"
                                       HorizontalOptions="Fill"
                                       VerticalOptions="Fill" />
            </Grid>

            <!-- 🌲 Panel 2: Tree Preview -->
            <Grid Grid.Column="1"
                  Style="{StaticResource PanelContainer}"
                  RowDefinitions="Auto,*"
                  HorizontalOptions="Fill"
                  VerticalOptions="Fill">

                <views:TreePreviewView Grid.Row="1"
                                       ViewModel="{Binding TreePreview}"
                                       HorizontalOptions="Fill"
                                       VerticalOptions="Fill" />
            </Grid>

            <!-- ⚙️ Panel 3: Options Drawer -->
            <Grid Grid.Column="2"
                  Style="{StaticResource PanelContainer}"
                  RowDefinitions="Auto,*"
                  WidthRequest="320"
                  HorizontalOptions="End"
                  VerticalOptions="Fill">

                <views:OptionsDrawerView Grid.Row="1"
                                         ViewModel="{Binding OptionsPanel}"
                                         HorizontalOptions="Fill"
                                         VerticalOptions="Fill" />
            </Grid>
        </Grid>
    </Grid>
</ContentPage>
