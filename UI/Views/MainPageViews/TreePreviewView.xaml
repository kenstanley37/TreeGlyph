<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:TreeGlyph.UI.ViewModels.MainPageViewModel"
             x:Class="TreeGlyph.UI.Views.MainPageViews.TreePreviewView"
             x:Name="Root"
             x:DataType="vm:TreePreviewViewModel">

    <Grid RowDefinitions="Auto,Auto,*,Auto"
          RowSpacing="8"
          Padding="12"
          BackgroundColor="{StaticResource BaseBackground}">

        <!-- 📋 Metrics + Copy Button Row -->
        <Grid Grid.Row="0"
              ColumnDefinitions="*,Auto"
              Padding="0,0,0,4"
              VerticalOptions="Center"
              HorizontalOptions="Fill">

            <!-- ⏱ Metrics Left-Aligned -->
            <HorizontalStackLayout Grid.Column="0"
                                   Spacing="16"
                                   HorizontalOptions="Start"
                                   VerticalOptions="Center">
                <Label Text="{Binding ElapsedTime, StringFormat='Elapsed: {0}'}"
                       Style="{StaticResource CaptionText}" />

                <Label Text="{Binding MemoryUsage, StringFormat='Memory: {0}'}"
                       Style="{StaticResource CaptionText}" />
            </HorizontalStackLayout>

            <!-- 📋 Copy Button Right-Aligned -->
            <Button Grid.Column="1"
                    Text="Copy Preview"
                    Command="{Binding CopyPreviewCommand}"
                    Style="{StaticResource NavButtonStyle}"
                    IsEnabled="{Binding HasSelectedFolder}"
                    VerticalOptions="Center"
                    HorizontalOptions="End" />
        </Grid>

        <!-- 📂 Selected Folder Path -->
        <Label Grid.Row="1"
               Text="{Binding SelectedFolderPath, StringFormat='Currently Building Tree for Folder: {0}'}"
               Style="{StaticResource CaptionText}"
               LineBreakMode="TailTruncation"
               MaxLines="1"
               Margin="0,0,0,4"
               IsVisible="{Binding HasSelectedFolder}" />

        <!-- 🖼️ Preview Output -->
        <Border Grid.Row="2"
                Style="{StaticResource ModalContainer}"
                Stroke="{StaticResource DividerBrush}"
                BackgroundColor="{StaticResource EditorBackground}"
                VerticalOptions="Fill"
                HorizontalOptions="Fill">
            <ScrollView VerticalScrollBarVisibility="Always"
                        HorizontalScrollBarVisibility="Always"
                        VerticalOptions="Fill"
                        HorizontalOptions="Fill">
                <Editor Text="{Binding TreeOutput}"
                        Style="{StaticResource LogEditorStyle}"
                        AutoSize="TextChanges"
                        VerticalOptions="Fill"
                        HorizontalOptions="Fill" />
            </ScrollView>
        </Border>

        <!-- ⚠️ Skipped Folder Log -->
        <Border Grid.Row="3"
                Stroke="{StaticResource ErrorBrush}"
                BackgroundColor="{StaticResource OverlayBackground}"
                Padding="6"
                Margin="0,8,0,0"
                VerticalOptions="Start"
                HorizontalOptions="Fill">
            <VerticalStackLayout Spacing="4">
                <Label Text="Skipped Folders (due to access issues):"
                       Style="{StaticResource LogErrorLabel}"
                       FontAttributes="Bold" />

                <Editor Text="{Binding SkippedPathsLog}"
                        Style="{StaticResource LogEditorStyle}"
                        TextColor="{StaticResource ErrorColor}"
                        AutoSize="TextChanges"
                        HeightRequest="120" />
            </VerticalStackLayout>
        </Border>

    </Grid>
</ContentView>