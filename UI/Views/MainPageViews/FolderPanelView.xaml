<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:TreeGlyph.UI.ViewModels.MainPageViewModel"
             x:Class="TreeGlyph.UI.Views.MainPageViews.FolderPanelView"
             x:Name="Root"
             x:DataType="vm:FolderPanelViewModel"
             BackgroundColor="{StaticResource PanelBackground}">

    <ScrollView VerticalScrollBarVisibility="Always"
                HorizontalScrollBarVisibility="Never"
                VerticalOptions="Fill"
                HorizontalOptions="Fill"
                Padding="0">

        <VerticalStackLayout Padding="16"
                             Spacing="16"
                             HorizontalOptions="Fill"
                             VerticalOptions="Start">

            <!-- 📁 Exclude Patterns Header -->
            <HorizontalStackLayout Spacing="6" VerticalOptions="Center">
                <Label Text="Exclude Patterns (.gitignore-style):"
                       Style="{StaticResource Heading3}" />

                <Label Text="(i)"
                       Style="{StaticResource BodyText}"
                       FontAttributes="Bold"
                       TextColor="{StaticResource AccentColor}"
                       VerticalOptions="Center">
                    <Label.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding ShowExclusionInfoCommand}" />
                    </Label.GestureRecognizers>
                </Label>
            </HorizontalStackLayout>

            <!-- 📋 View Examples Button -->
            <Button Text="View Examples"
                    Style="{StaticResource UtilityButton}"
                    Command="{Binding ShowExclusionExamplesCommand}"
                    HorizontalOptions="Start" />

            <!-- 📝 Exclude Patterns Editor -->
            <Border Stroke="{StaticResource DividerBrush}"
                    StrokeShape="RoundRectangle 6"
                    BackgroundColor="{StaticResource EditorBackground}"
                    Padding="2"
                    Margin="0,4,0,8"
                    HorizontalOptions="Fill"
                    VerticalOptions="Start">

                <Editor Text="{Binding ExclusionsLocal}"
                        Placeholder="{Binding ExclusionPlaceholder}"
                        Style="{StaticResource StandardEditor}"
                        IsReadOnly="False"
                        HeightRequest="128"
                        VerticalOptions="Fill"
                        HorizontalOptions="Fill" />
            </Border>

            <!-- 🌐 Global Ignore Toggle -->
            <VerticalStackLayout Spacing="12"
                                 Padding="0,4,0,0"
                                 VerticalOptions="Start">
                <Label Text="Apply Global Ignore During Tree Generation"
                       Style="{StaticResource BodyText}" />
                <Grid Padding="0" VerticalOptions="Center">
                    <Switch IsToggled="{Binding IsGlobalIgnoreEnabled}"
                            Style="{StaticResource StandardSwitch}" />
                </Grid>
            </VerticalStackLayout>

            <!-- 🌐 Global Ignore Trigger -->
            <Button Text="Edit Global Ignore Rules"
                    Style="{StaticResource UtilityButton}"
                    Command="{Binding GlobalIgnore.EditGlobalIgnoreCommand}"
                    Margin="0,8,0,0"
                    HorizontalOptions="Start" />

            <!-- 🌐 Global Ignore Editor Modal -->
            <Border IsVisible="{Binding GlobalIgnore.IsEditingGlobalIgnore}"
                    Stroke="{StaticResource DividerBrush}"
                    StrokeShape="RoundRectangle 6"
                    BackgroundColor="{StaticResource PanelBackground}"
                    Padding="12"
                    Margin="0,8,0,0"
                    HorizontalOptions="Fill"
                    VerticalOptions="Start">

                <VerticalStackLayout Spacing="8">
                    <Label Text="Global Exclude Patterns (applied to all folders):"
                           Style="{StaticResource Heading3}" />

                    <ScrollView HorizontalScrollBarVisibility="Always"
                                VerticalScrollBarVisibility="Always"
                                HeightRequest="120"
                                HorizontalOptions="Fill"
                                VerticalOptions="Fill">
                        <Editor Text="{Binding GlobalIgnore.GlobalIgnoreExclusions}"
                                Placeholder="e.g. *.user, .vs/, *.tmp"
                                Style="{StaticResource StandardEditor}"
                                FontSize="13"
                                IsReadOnly="False" />
                    </ScrollView>

                    <HorizontalStackLayout HorizontalOptions="End" Spacing="8">
                        <Button Text="Save Global Ignore"
                                Style="{StaticResource UtilityButton}"
                                Command="{Binding GlobalIgnore.SaveGlobalIgnoreCommand}" />
                        <Button Text="Cancel"
                                Style="{StaticResource UtilityButton}"
                                Command="{Binding GlobalIgnore.CancelEditCommand}" />
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Border>

            <!-- ✅ Apply Global Ignore Manually -->
            <Button Text="Apply Global Ignore to This Folder"
                    Style="{StaticResource UtilityButton}"
                    Command="{Binding GlobalIgnore.ApplyGlobalIgnoreCommand}"
                    IsEnabled="{Binding HasSelectedFolder}"
                    Margin="0,8,0,0"
                    HorizontalOptions="Start" />

        </VerticalStackLayout>
    </ScrollView>
</ContentView>