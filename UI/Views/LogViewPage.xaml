<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:TreeGlyph.UI.ViewModels.UtilityViewModels"
             xmlns:vm="clr-namespace:TreeGlyph.UI.ViewModels.UtilityViewModels"
             xmlns:sys="clr-namespace:System;assembly=netstandard"
             xmlns:models="clr-namespace:TreeGlyph.UI.ViewModels.UtilityViewModels"
             x:Class="TreeGlyph.UI.Views.LogViewPage"
             Padding="0"
             Shell.NavBarIsVisible="False"
             x:DataType="viewmodels:LogViewModel">

    <Grid RowDefinitions="Auto,Auto,*"
          Padding="20"
          RowSpacing="12">

        <!-- ðŸ”¼ Top Section: Controls + Keys -->
        <Grid Grid.Row="0"
              ColumnDefinitions="Auto,*"
              ColumnSpacing="16">

            <!-- ðŸŸ¦ Left Panel: Log Date Picker + Select All -->
            <VerticalStackLayout Grid.Column="0"
                                 Spacing="12"
                                 WidthRequest="260"
                                 VerticalOptions="Start">

                <Picker Title="Select a log date"
                        ItemsSource="{Binding AvailableLogDates}"
                        ItemDisplayBinding="{Binding Date, StringFormat='{}{0:MM/dd/yyyy}'}"
                        SelectedItem="{Binding SelectedLogDate, Mode=TwoWay}"
                        WidthRequest="240" />

                <HorizontalStackLayout>
                    <CheckBox x:Name="SelectAllCheckBox"
                              IsChecked="{Binding IsAllKeysSelected, Mode=TwoWay}"
                              CheckedChanged="OnSelectAllCheckedChanged" />
                    <Label Text="Select All"
                           VerticalTextAlignment="Center"
                           Margin="6,0,0,0"
                           TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                </HorizontalStackLayout>

                <SearchBar Placeholder="Search logs..."
                           Text="{Binding SearchText}"
                           WidthRequest="240" />

                <Button Text="Load Logs"
                        Command="{Binding LoadLogsCommand}"
                        WidthRequest="240" />
            </VerticalStackLayout>

            <!-- ðŸŸ¨ Right Panel: Unique Keys from Selected Log -->
            <ScrollView Grid.Column="1"
                        Orientation="Vertical"
                        Padding="0"
                        Margin="0">

                <FlexLayout Wrap="Wrap"
                            Direction="Row"
                            JustifyContent="Start"
                            AlignItems="Start"
                            BindableLayout.ItemsSource="{Binding AvailableKeys}">

                    <BindableLayout.ItemTemplate>
                        <DataTemplate x:DataType="models:SelectableKeyItem">
                            <Grid ColumnDefinitions="50,160"
                                  Padding="0"
                                  Margin="2,2,2,0"
                                  BackgroundColor="{Binding BackgroundColor}">

                                <CheckBox Grid.Column="0"
                                          IsChecked="{Binding IsSelected}"
                                          CheckedChanged="OnCategoryCheckedChanged"
                                          Margin="0" />

                                <Label Grid.Column="1"
                                       Text="{Binding Key}"
                                       TextColor="{AppThemeBinding Light=Black, Dark=White}"
                                       VerticalTextAlignment="Center"
                                       Padding="0"
                                       Margin="2,0,0,0" />
                            </Grid>
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </FlexLayout>
            </ScrollView>
        </Grid>

        <!-- ðŸ”³ Divider -->
        <BoxView Grid.Row="1"
                 Grid.ColumnSpan="2"
                 HeightRequest="1"
                 BackgroundColor="{AppThemeBinding Light=#CCC, Dark=#444}"
                 Margin="0,6" />

        <!-- ðŸ”½ Bottom Section: Filtered Log Output -->
        <CollectionView Grid.Row="2"
                ItemsSource="{Binding FilteredLogs}"
                BackgroundColor="#000"
                VerticalOptions="Fill">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="x:String">
                    <Editor Text="{Binding}"
                            FontFamily="Consolas"
                            FontSize="12"
                            TextColor="{AppThemeBinding Light=White, Dark=White}"
                            BackgroundColor="Transparent"
                            IsReadOnly="True"
                            AutoSize="TextChanges"
                            Margin="0"
                             />
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>


    </Grid>
</ContentPage>